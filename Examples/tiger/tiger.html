<!DOCTYPE html>
<meta charset="utf-8">
<link href="visdock.css" rel="stylesheet" type="text/css"/>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Rapha�l � Tiger</title>
        <script src="raphael.js"></script>
        <script src="tiger.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>

    <script type="text/javascript" src="visdock.js"></script>
    <script type="text/javascript" src="2D.js"></script>
    <script src="IntersectionUtilities.js"></script>
    <script src="visdock.utils.js"></script>
        <script>
var viewport;
var height;
var width;
            window.onload = function () {
    width = 800;
    height = 800;
    VisDock.init("body", width, height);
    VisDock.SelectShape = "circle"
    VisDock.opacity = 0.8;
    viewport = VisDock.getViewport();
    //viewport.attr("class", "chart");
                var r = Raphael(tiger);
for (var i=0;i<r.length;i++){

	var d = r[i][0].getAttributeNS(null,"d");
	var stroke = r[i][0].getAttributeNS(null,"stroke");
	var fill = r[i][0].getAttributeNS(null,"fill");
	var swidth = r[i][0].getAttributeNS(null,"stroke-width");
	var tform = r[i][0].getAttributeNS(null,"transform");

	viewport.append("path")
		.attr("d",d)
		.attr("stroke",stroke)
		.attr("fill",fill)
		.attr("stroke-width",swidth)
		.attr("transform",tform)

}
r.remove()
Panel.x = 200;
Panel.y = 200;
Panel.setTransform()
VisDock.eventHandler = {
    getHitsPolygon: function(points, inclusive){

	var paths = d3.selectAll("path")[0];
	var nElements = paths.length; 
	var hits = [];
	var count = 0;
	var captured = 0;
	var shapebound = new createPolygon(points);

	for (var i = 0; i < nElements; i++){
	    captured = shapebound.intersectPath(paths[i], inclusive);
//alert(captured)
	    if (captured == 1){
		//var cl = aa[i].getAttributeNS(null,"class").split("-")[0];
		//var r = cl.split("q")[1];
		//rts[num][count] = parseInt(r);

		hits[count] = i;
		count++;
	    }
	
	}
	//alert(rts[0])
	return hits;
    },
    getHitsLine: function(points, inclusive){

	var aa = getPaths();
	var nElements = getNumberOfPaths(); 	
	var hits = [];
	var count = 0;
	var captured = 0;
	rts[num] = [];
	for (var i=0; i<nElements; i++){


 	    captured = 0;
	    captured = PathLineIntersection(points,aa[i]);

		//alert("SDJFKL");
	    if (captured == 1){
		var cl = aa[i].getAttributeNS(null,"class").split("-")[0];
		var r = cl.split("q")[1];
		rts[num][count] = parseInt(r);
		hits[count] = i;
		count++;
	    }
	}
	return hits;
    },
    getHitsEllipse: function(points, inclusive){

	var aa = getPaths();
	var nElements = getNumberOfPaths();	
	//var aa2 = getNodes(nElements);

	var hits = [];
	var count = 0;
	var captured = 0;
	points[0] -= 200;
	points[1] -= 200;

	var ellipse = EllipseInit(points);//alert(points)

	for (var i=0; i<nElements; i++){
 	    captured = 0;

	t = aa[i].getAttributeNS(null,"transform").split(",")
	x = t[4];
	y = t[5].split(")")[0]

	    captured = PathEllipseIntersection(ellipse,aa[i]);
	    		
	    if (captured == 1){
		hits[count] = i;
		count++;
	    }
	}
	return hits;
    },
    setColor: function(hits){
	var paths = d3.selectAll("path")[0];
	for (var i=0;i<hits.length;i++){
	    VisDock.utils.addPathLayer(paths[hits[i]], 
	    	"fill: " + VisDock.color[num - 1] + "; opacity: 0.5");
	}
    },
    changeColor: function(color, query, index){
    	var vis = VisDock.utils.getQueryVisibility(index);
	for (var i=0;i<query.length;i++){
	    query[i][0][0].setAttributeNS(null, "style", "fill: " + color + "; opacity: " + vis)
	}
    },
    changeVisibility: function(vis, query){
    	var color = VisDock.utils.getQueryColor(index);
	for (var i=0;i<query.length;i++){
	    query[i][0][0].setAttributeNS(null, "style", "fill: " + color + "; opacity: " + vis)
	}
    },
    removeColor: function(hits, index){
	for (var i=0;i<hits.length;i++){
	    //alert(hits[i])
	    hits[i].remove();
	}
    },
    QueryClick: function(query, index){
	var data = rts[index];
	var movex = mouseclick*225+50;
	var margin = 25;
	var bw = (200-margin*2)/data.length;
	var ymax = Math.max.apply(null,data)
	var minigraph = viewport.append("g")
	    .attr("transform","translate("+movex+",500)")

	minigraph.append("rect")
	    .attr("width",200).attr("height",200)
	    .attr("stroke","black")
	    .attr("fill","white")

	for (var i=0;i<data.length;i++){
	    var h = (200-margin*2)*data[i]/ymax;
	    var movey = margin+(200-margin*2-h);
	    minigraph.append("rect")
		.attr("width", bw)
		.attr("height", h)
		.attr("x",(margin+i*bw))
		.attr("y",movey)
		.attr("stroke","black")
		.attr("fill",QueryManager.colors[index]);
	}	

	mouseclick++;
    }
}

	}

    //VisDock.init("body", 1200, 1000);
//alert("SDFJKL")	    
    //var viewport = VisDock.getViewport();
    //viewport.attr("class", "chart");



        </script>
    </head>

</html>
